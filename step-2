# Ghost-Razorpay-Zapier Integration - Sequence Diagram

```mermaid
sequenceDiagram
    participant Admin as Admin/User
    participant Ghost as Ghost Admin Panel
    participant Razorpay as Razorpay Dashboard
    participant Customer as Customer
    participant RazorpayAPI as Razorpay Payment API
    participant Zapier as Zapier Platform
    participant GhostAPI as Ghost Admin API

    Note over Admin, GhostAPI: Step 1: Setup Ghost Admin API Credentials
    Admin->>Ghost: Navigate to Settings > Integrations
    Ghost->>Admin: Display integrations page
    Admin->>Ghost: Click "+ Custom integration"
    Admin->>Ghost: Enter integration name ("Zapier Razorpay Integration")
    Ghost->>Admin: Generate Admin API Key & API URL
    Admin->>Admin: Copy and store credentials

    Note over Admin, GhostAPI: Step 2: Setup Razorpay Webhook
    Admin->>Razorpay: Login to Razorpay Dashboard
    Admin->>Razorpay: Navigate to Settings > Webhooks
    Admin->>Razorpay: Click "+ Add New Webhook"
    Admin->>Zapier: Create new Zap to get webhook URL
    Zapier->>Admin: Provide Custom Webhook URL
    Admin->>Razorpay: Enter Zapier webhook URL
    Admin->>Razorpay: Select events (payment.captured, subscription.charged)
    Admin->>Razorpay: Enter webhook secret
    Razorpay->>Admin: Confirm webhook creation

    Note over Admin, GhostAPI: Step 3: Create Zapier Zap (Razorpay Trigger)
    Admin->>Zapier: Search and select "Webhooks by Zapier"
    Admin->>Zapier: Choose "Catch Hook" as trigger event
    Zapier->>Admin: Provide webhook URL for Razorpay
    
    rect rgb(240, 248, 255)
        Note over Customer, RazorpayAPI: Test Payment Flow
        Customer->>RazorpayAPI: Make test payment
        RazorpayAPI->>RazorpayAPI: Process payment
        RazorpayAPI->>Zapier: Send webhook notification (payment.captured)
        Zapier->>Admin: Capture webhook data
    end
    
    Admin->>Zapier: Test trigger and examine payload data
    Zapier->>Admin: Show captured payment data (email, contact, status, etc.)

    Note over Admin, GhostAPI: Step 4: Create Zapier Action (Ghost Member Management)
    Admin->>Zapier: Add Action Step
    Admin->>Zapier: Select "Webhooks by Zapier" > "Custom Request"
    
    rect rgb(255, 248, 240)
        Note over Zapier, GhostAPI: Member Lookup Flow
        Admin->>Zapier: Configure GET request to find member
        Note right of Admin: URL: /ghost/api/admin/members/?search={{email}}
        Note right of Admin: Headers: Authorization: Ghost-Admin {api_key}
        Admin->>Zapier: Test action
        Zapier->>GhostAPI: GET /members/?search={email}
        GhostAPI->>Zapier: Return member data or empty array
        Zapier->>Admin: Display search results
    end

    Note over Admin, GhostAPI: Runtime: Automated Payment Processing
    rect rgb(240, 255, 240)
        Customer->>RazorpayAPI: Make actual payment
        RazorpayAPI->>RazorpayAPI: Process payment successfully
        RazorpayAPI->>Zapier: Trigger webhook (payment.captured)
        
        Zapier->>GhostAPI: Search for member by email
        alt Member exists
            GhostAPI->>Zapier: Return existing member data
            Zapier->>GhostAPI: Update member (optional: add tags, update subscription)
            GhostAPI->>Zapier: Confirm member update
        else Member doesn't exist
            Zapier->>GhostAPI: Create new member with payment email
            GhostAPI->>Zapier: Return new member data
        end
        
        Zapier->>Admin: Log successful automation (optional notification)
    end

    Note over Admin, GhostAPI: Integration Complete âœ…
```

## Key Interactions Summary

### Initial Setup Phase
1. **Ghost API Setup**: Admin creates custom integration in Ghost to get API credentials
2. **Razorpay Webhook Configuration**: Admin configures Razorpay to send payment notifications to Zapier
3. **Zapier Zap Creation**: Admin creates automated workflow to catch Razorpay webhooks and interact with Ghost API
4. **Testing**: Admin tests the integration with sample payments

### Runtime Automation Phase
1. **Payment Trigger**: Customer makes payment through Razorpay
2. **Webhook Delivery**: Razorpay sends payment notification to Zapier
3. **Member Lookup**: Zapier searches Ghost for existing member using payment email
4. **Member Management**: Zapier either updates existing member or creates new member in Ghost
5. **Completion**: Automated membership management based on successful payments

## Critical Components

- **Ghost Admin API**: Provides programmatic access to member management
- **Razorpay Webhooks**: Real-time payment notifications 
- **Zapier Integration**: No-code automation platform connecting Razorpay and Ghost
- **Authentication**: Secure API key-based authentication for Ghost Admin API
- **Error Handling**: Built-in retry mechanisms and error logging in Zapier

## Benefits

- **Automated Membership**: No manual intervention needed for member creation/updates
- **Real-time Processing**: Members are added immediately upon successful payment
- **Scalable Solution**: Handles high volume of payments automatically
- **Audit Trail**: Complete log of all automation activities in Zapier
